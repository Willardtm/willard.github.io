<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>TensorFlow 2.0 使用指南 (2020.4.26更新) | Klaus&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前后大概花了一周半的时间把TensorFlow2.0的框架学完，这个版本相较于1.0在代码上要更加易于理解和操作。所以这里用这篇博客来记录 TensorFlow 2.0 中的各种操作细节，算是个人备忘录版的使用指南吧。">
<meta name="keywords" content="NLP">
<meta property="og:type" content="article">
<meta property="og:title" content="TensorFlow 2.0 使用指南 (2020.4.26更新)">
<meta property="og:url" content="http://yoursite.com/2020/04/26/TensorFlow-2-0-使用指南/index.html">
<meta property="og:site_name" content="Klaus&#39;s Blog">
<meta property="og:description" content="前后大概花了一周半的时间把TensorFlow2.0的框架学完，这个版本相较于1.0在代码上要更加易于理解和操作。所以这里用这篇博客来记录 TensorFlow 2.0 中的各种操作细节，算是个人备忘录版的使用指南吧。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://s1.ax1x.com/2020/04/26/Jcvy34.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/04/26/J2tlWt.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/04/26/J2dvVS.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/04/26/JRAVmT.png">
<meta property="og:updated_time" content="2020-04-26T16:15:47.399Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TensorFlow 2.0 使用指南 (2020.4.26更新)">
<meta name="twitter:description" content="前后大概花了一周半的时间把TensorFlow2.0的框架学完，这个版本相较于1.0在代码上要更加易于理解和操作。所以这里用这篇博客来记录 TensorFlow 2.0 中的各种操作细节，算是个人备忘录版的使用指南吧。">
<meta name="twitter:image" content="https://s1.ax1x.com/2020/04/26/Jcvy34.png">
  
    <link rel="alternate" href="/atom.xml" title="Klaus&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Klaus&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">MIA SAN MIA</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Buscar"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-TensorFlow-2-0-使用指南" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/26/TensorFlow-2-0-使用指南/" class="article-date">
  <time datetime="2020-04-26T06:06:19.000Z" itemprop="datePublished">2020-04-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/NLP/">NLP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      TensorFlow 2.0 使用指南 (2020.4.26更新)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
	  <!-- Table of Contents -->
		
		  <div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据预处理"><span class="toc-number">1.</span> <span class="toc-text">数据预处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tf框架自带的数据集"><span class="toc-number">1.1.</span> <span class="toc-text">tf框架自带的数据集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sklearn自带的数据集"><span class="toc-number">2.</span> <span class="toc-text">sklearn自带的数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义数据集"><span class="toc-number">3.</span> <span class="toc-text">自定义数据集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#csv数据处理"><span class="toc-number">3.1.</span> <span class="toc-text">csv数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#x-label处理方式一：tf-data-experimental-make-csv-dataset"><span class="toc-number">3.1.1.</span> <span class="toc-text">x,label处理方式一：tf.data.experimental.make_csv_dataset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x-label处理方式二-pandas"><span class="toc-number">3.1.2.</span> <span class="toc-text">x,label处理方式二:pandas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#离散型特征"><span class="toc-number">3.1.3.</span> <span class="toc-text">离散型特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#连续型数据处理"><span class="toc-number">3.1.4.</span> <span class="toc-text">连续型数据处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建预处理层"><span class="toc-number">3.1.5.</span> <span class="toc-text">创建预处理层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模型构建，训练与评估"><span class="toc-number">3.2.</span> <span class="toc-text">模型构建，训练与评估</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简易版泰坦尼克生存预测模型完整代码"><span class="toc-number">3.2.1.</span> <span class="toc-text">简易版泰坦尼克生存预测模型完整代码</span></a></li></ol></li></ol></li></ol>
		  </div>
		
        <p>前后大概花了一周半的时间把TensorFlow2.0的框架学完，这个版本相较于1.0在代码上要更加易于理解和操作。<br>所以这里用这篇博客来记录 TensorFlow 2.0 中的各种操作细节，算是个人备忘录版的使用指南吧。<br><a id="more"></a></p>
<p>本篇博客会按照数据处理，Estimator，模型保存，CNN及其实践，RNN及其实践，注意力机制等几个部分来撰写。<br>p.s. 以前开发做点Python相关的东西还是习惯用Pycharm，不过学习这个框架的过程中由于需要清晰的看到每个步骤的结果，所以用了一下Jupyter，害，用户体验嘛，那当然是极好的！以后做神经网络模型这类型的，我可能会继续沿用Jupyter，不过如果项目规模偏大，那还是回到Pycharm。btw,VScode编写ipynb体验还不错。</p>
<h2 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h2><p>以我个人的看法，数据预处理这部分内容在神经网络的构建中可以说是极其重要的。如果没有处理好数据，并生成用以训练的向量，那这个模型基本白搭，所以这块的内容我会尽量去详细的记录。</p>
<h3 id="tf框架自带的数据集"><a href="#tf框架自带的数据集" class="headerlink" title="tf框架自带的数据集"></a>tf框架自带的数据集</h3><p>tf框架最常见的自带数据集包括：mnist,fashion_minist，imbd等，这类数据集最大的好处就是自带切分功能。<br>引用方式通常比较简单，并且已经是向量化的数据，以这里取出来的数据来说，就是一张大小为28x28的图像各个像素点的值。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import tensorflow as tf</span><br><span class="line"><span class="keyword">from</span> tensorflow import keras</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接获取数据</span></span><br><span class="line"><span class="attribute">mnist</span>=keras.datasets.mnist</span><br><span class="line">(x_train_all,y_train_all),(x_test,y_test)=mnist.load_data()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切分训练集和验证集</span></span><br><span class="line">x_train,<span class="attribute">y_train</span>=x_train_all[:5000],y_train_all[:5000]</span><br><span class="line">x_valid,<span class="attribute">y_valid</span>=x_train_all[5000:],y_train_all[5000:]</span><br></pre></td></tr></table></figure></p>
<h2 id="sklearn自带的数据集"><a href="#sklearn自带的数据集" class="headerlink" title="sklearn自带的数据集"></a>sklearn自带的数据集</h2><p>sklearn下的数据集类似于tf下面的，不过需要额外引入另外的两个包，一个负责取出数据集，一个负责对训练集和测试集进行分割。<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sklearn</span><br><span class="line">from sklearn.datasets <span class="keyword">import</span> fetch_california_housing # 取出数据集</span><br><span class="line">from sklearn.model_selection <span class="keyword">import</span> train_test_split # 对数据集进行分割</span><br><span class="line"></span><br><span class="line"># 取出相应的数据集</span><br><span class="line">housing=fetch_california_housing()</span><br><span class="line"></span><br><span class="line"># 打印出相关信息</span><br><span class="line"><span class="built_in">print</span>(housing.DESCR) # 数据描述</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'----------------'</span>)</span><br><span class="line"><span class="built_in">print</span>(housing.<span class="keyword">data</span>.<span class="built_in">shape</span>) # 数据大小</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'----------------'</span>)</span><br><span class="line"><span class="built_in">print</span>(housing.<span class="keyword">target</span>.<span class="built_in">shape</span>) # label</span><br><span class="line"></span><br><span class="line">x_train_all, x_test, y_train_all, y_test = train_test_split(</span><br><span class="line">    housing.<span class="keyword">data</span>, housing.<span class="keyword">target</span>, random_state = <span class="number">7</span>)</span><br><span class="line">x_train, x_valid, y_train, y_valid = train_test_split(</span><br><span class="line">    x_train_all, y_train_all, random_state = <span class="number">11</span>)</span><br><span class="line"><span class="built_in">print</span>(x_train.<span class="built_in">shape</span>, y_train.<span class="built_in">shape</span>)</span><br><span class="line"><span class="built_in">print</span>(x_valid.<span class="built_in">shape</span>, y_valid.<span class="built_in">shape</span>)</span><br><span class="line"><span class="built_in">print</span>(x_test.<span class="built_in">shape</span>, y_test.<span class="built_in">shape</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="自定义数据集"><a href="#自定义数据集" class="headerlink" title="自定义数据集"></a>自定义数据集</h2><p>以我过去从事NLP文本分类的经验，单从上面两个包中提供的数据集不满足实验需求，不同的文章中使用到的数据集不一样，所以还需要具备处理其他数据集的能力。</p>
<h3 id="csv数据处理"><a href="#csv数据处理" class="headerlink" title="csv数据处理"></a>csv数据处理</h3><h4 id="x-label处理方式一：tf-data-experimental-make-csv-dataset"><a href="#x-label处理方式一：tf-data-experimental-make-csv-dataset" class="headerlink" title="x,label处理方式一：tf.data.experimental.make_csv_dataset"></a>x,label处理方式一：tf.data.experimental.make_csv_dataset</h4><p>这里直接使用这俩数据集（泰坦尼克号生存数据集），下载地址如下：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http<span class="variable">s:</span>//storage.googleapis.<span class="keyword">com</span>/<span class="keyword">tf</span>-datasets/titanic/train.csv</span><br><span class="line">http<span class="variable">s:</span>//storage.googleapis.<span class="keyword">com</span>/<span class="keyword">tf</span>-datasets/titanic/<span class="built_in">eval</span>.csv</span><br></pre></td></tr></table></figure></p>
<p>下载下来以后单独保存在一个 dataset 文件夹下面，下载完成以后，有两种方法可以查看csv中数据集包含的数据：<br><b>1. 使用pandas</b><br>关于pandas部分库的操作，之前我写过一篇笔记，可以作为参考：<a href="http://klausvon.cn/2018/10/05/Python-%E8%AF%BB%E5%86%99csv%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C/" target="_blank" rel="noopener">Python 读写csv文件相关操作</a></p>
<p>这里直接取出列表名称,和相关数据<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">file</span>=pd.read_csv(<span class="string">'./dataset/train.csv'</span>)</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">list</span>(<span class="keyword">file</span>.head()))#列表名称</span><br><span class="line"><span class="keyword">print</span>(<span class="keyword">file</span>.head())#列表数据</span><br></pre></td></tr></table></figure></p>
<p><img src="https://s1.ax1x.com/2020/04/26/Jcvy34.png" alt=""></p>
<p><b>2. 直接在Jupyter的环境下查看</b><br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">!head &#123;文件路径&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>这些取出来的列名参数需要传参给tf.data.experimental.make_csv_dataset下面的column_names参数。<br>使用这个包和取出的列名来构造可以用于基于TensorFlow搭建模型的训练和测试数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> tensorflow_datasets <span class="keyword">as</span> tfds</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">file_path=<span class="string">'./dataset/train.csv'</span></span><br><span class="line">file=pd.read_csv(file_path)</span><br><span class="line">csv_columns=list(file.head())</span><br><span class="line">print(csv_columns)<span class="comment">#列表名称</span></span><br><span class="line">print(file.head())<span class="comment">#列表数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 label</span></span><br><span class="line">label_culomn=<span class="string">'survived'</span></span><br><span class="line">labels=[<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dataset</span><span class="params">(file_path)</span>:</span></span><br><span class="line">    dataset=tf.data.experimental.make_csv_dataset(</span><br><span class="line">        file_path,</span><br><span class="line">        batch_size=<span class="number">12</span>,</span><br><span class="line">        label_name=label_culomn,<span class="comment"># 取出某列的数据作为label</span></span><br><span class="line">        na_value=<span class="string">'?'</span>,<span class="comment"># 识别NA/NaN的附加字符串,设置为?</span></span><br><span class="line">        num_epochs=<span class="number">1</span>,<span class="comment"># 遍历数据集的次数</span></span><br><span class="line">        ignore_errors=<span class="keyword">True</span>)</span><br><span class="line">    <span class="keyword">return</span> dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成的值类型为:</span></span><br><span class="line"><span class="comment"># &lt;class 'tensorflow.python.data.ops.dataset_ops.PrefetchDataset'&gt;</span></span><br><span class="line"><span class="comment"># 如果想查看其中的内容,可以使用iter进行迭代,通过next嵌套iter可以查看第一轮运行的数据</span></span><br><span class="line"><span class="comment"># 第一轮运行数据的大小取决于设置的batch_size</span></span><br><span class="line">raw_train_data=get_dataset(file_path) </span><br><span class="line">raw_test_data=get_dataset(file_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看生成的数据集中的样本和标签</span></span><br><span class="line">example,label=next(iter(raw_train_data))</span><br><span class="line">print(<span class="string">'Example:'</span>,example) <span class="comment"># sex,age,n_siblings_spouses,parch,fare,class,deck,embark_town,alone</span></span><br><span class="line">print(<span class="string">'Label:'</span>,label) <span class="comment"># label:survived</span></span><br></pre></td></tr></table></figure></p>
<p>输出值如下：<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Example:OrderedDict([(<span class="string">'sex'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=<span class="keyword">string</span>, numpy=</span><br><span class="line"><span class="keyword">array</span>([b<span class="string">'male'</span>, b<span class="string">'female'</span>, b<span class="string">'male'</span>, b<span class="string">'male'</span>, b<span class="string">'male'</span>, b<span class="string">'female'</span>, b<span class="string">'male'</span>,</span><br><span class="line">       b<span class="string">'male'</span>, b<span class="string">'female'</span>, b<span class="string">'male'</span>, b<span class="string">'male'</span>, b<span class="string">'female'</span>], dtype=<span class="keyword">object</span>)&gt;), (<span class="string">'age'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=float32, numpy=</span><br><span class="line"><span class="keyword">array</span>([<span class="number">28</span>. , <span class="number">28</span>. , <span class="number">21</span>. , <span class="number">26</span>. , <span class="number">45</span>. , <span class="number">31</span>. , <span class="number">28</span>. , <span class="number">18</span>. , <span class="number">28</span>. , <span class="number">43</span>. , <span class="number">32.5</span>,</span><br><span class="line">       <span class="number">58</span>. ], dtype=float32)&gt;), (<span class="string">'n_siblings_spouses'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=int32, numpy=<span class="keyword">array</span>([<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>])&gt;), (<span class="string">'parch'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=int32, numpy=<span class="keyword">array</span>([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>])&gt;), (<span class="string">'fare'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=float32, numpy=</span><br><span class="line"><span class="keyword">array</span>([ <span class="number">35.5</span>   , <span class="number">133.65</span>  ,  <span class="number">73.5</span>   ,   <span class="number">8.05</span>  ,   <span class="number">8.05</span>  , <span class="number">164.8667</span>,</span><br><span class="line">        <span class="number">56.4958</span>,   <span class="number">7.7958</span>,  <span class="number">14.4542</span>,  <span class="number">26.25</span>  ,  <span class="number">30.0708</span>, <span class="number">153.4625</span>],</span><br><span class="line">      dtype=float32)&gt;), (<span class="string">'class'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=<span class="keyword">string</span>, numpy=</span><br><span class="line"><span class="keyword">array</span>([b<span class="string">'First'</span>, b<span class="string">'First'</span>, b<span class="string">'Second'</span>, b<span class="string">'Third'</span>, b<span class="string">'Third'</span>, b<span class="string">'First'</span>,</span><br><span class="line">       b<span class="string">'Third'</span>, b<span class="string">'Third'</span>, b<span class="string">'Third'</span>, b<span class="string">'Second'</span>, b<span class="string">'Second'</span>, b<span class="string">'First'</span>],</span><br><span class="line">      dtype=<span class="keyword">object</span>)&gt;), (<span class="string">'deck'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=<span class="keyword">string</span>, numpy=</span><br><span class="line"><span class="keyword">array</span>([b<span class="string">'A'</span>, b<span class="string">'unknown'</span>, b<span class="string">'unknown'</span>, b<span class="string">'unknown'</span>, b<span class="string">'unknown'</span>, b<span class="string">'C'</span>,</span><br><span class="line">       b<span class="string">'unknown'</span>, b<span class="string">'unknown'</span>, b<span class="string">'unknown'</span>, b<span class="string">'unknown'</span>, b<span class="string">'unknown'</span>, b<span class="string">'C'</span>],</span><br><span class="line">      dtype=<span class="keyword">object</span>)&gt;), (<span class="string">'embark_town'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=<span class="keyword">string</span>, numpy=</span><br><span class="line"><span class="keyword">array</span>([b<span class="string">'Southampton'</span>, b<span class="string">'Southampton'</span>, b<span class="string">'Southampton'</span>, b<span class="string">'Southampton'</span>,</span><br><span class="line">       b<span class="string">'Southampton'</span>, b<span class="string">'Southampton'</span>, b<span class="string">'Southampton'</span>, b<span class="string">'Southampton'</span>,</span><br><span class="line">       b<span class="string">'Cherbourg'</span>, b<span class="string">'Southampton'</span>, b<span class="string">'Cherbourg'</span>, b<span class="string">'Southampton'</span>],</span><br><span class="line">      dtype=<span class="keyword">object</span>)&gt;), (<span class="string">'alone'</span>, &lt;tf.Tensor: shape=(<span class="number">12</span>,), dtype=<span class="keyword">string</span>, numpy=</span><br><span class="line"><span class="keyword">array</span>([b<span class="string">'y'</span>, b<span class="string">'n'</span>, b<span class="string">'y'</span>, b<span class="string">'y'</span>, b<span class="string">'y'</span>, b<span class="string">'n'</span>, b<span class="string">'y'</span>, b<span class="string">'y'</span>, b<span class="string">'n'</span>, b<span class="string">'n'</span>, b<span class="string">'n'</span>,</span><br><span class="line">       b<span class="string">'n'</span>], dtype=<span class="keyword">object</span>)&gt;)])</span><br><span class="line"><span class="keyword">Label</span>:tf.Tensor([<span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>], shape=(<span class="number">12</span>,), dtype=int32)</span><br></pre></td></tr></table></figure></p>
<p>这里有个问题，如何单独查看example或者label中的值，这个很简单，这两个值类似于字典类型，以example举例子，取出age这一栏，并通过numpy形式展示：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="name">example</span>['age'].numpy())</span><br></pre></td></tr></table></figure></p>
<p><img src="https://s1.ax1x.com/2020/04/26/J2tlWt.png" alt=""></p>
<h4 id="x-label处理方式二-pandas"><a href="#x-label处理方式二-pandas" class="headerlink" title="x,label处理方式二:pandas"></a>x,label处理方式二:pandas</h4><p>基于pandas读取出来的csv文件可以直接使用pop函数来取出某个单独列的值。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line">train_df=pd.read_csv(<span class="string">'./dataset/train.csv'</span>)</span><br><span class="line">eval_df=pd.read_csv(<span class="string">'./dataset/eval.csv'</span>)</span><br><span class="line"></span><br><span class="line">y_train=train_df.pop(<span class="string">'survived'</span>)</span><br><span class="line">y_eval=eval_df.pop(<span class="string">'survived'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'train_df.shape:'</span>,train_df.shape)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'eval_df.shape:'</span>,eval_df.shape)</span></span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://s1.ax1x.com/2020/04/26/J2dvVS.png" alt=""></p>
<p>pandas在划分x和y的时候相对比之前tf.data.experimental.make_csv_dataset要简便不少，同时，取出的pandas Series数据可以在外嵌套一层numpy.array()就可以转换为numpy类型的array,然后通过reshape转换成模型需要的任意大小：<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="title">new_train_df</span>=np.array(train_df).reshape([<span class="number">-1</span>,])</span><br></pre></td></tr></table></figure></p>
<h4 id="离散型特征"><a href="#离散型特征" class="headerlink" title="离散型特征"></a>离散型特征</h4><p>上面介绍了两种对数据进行划分的方法，下面继续对数据进行分类。<br>这里直接引用官方文档的话：<br>csv数据中的有些列是分类的列，也就是说，这些列只能在有限的集合中取值。(这些列也就相当于是已经提取好的特征值)</p>
<p>使用 tf.feature_column API创建一个 tf.feature_column.indicator_column 集合，每个 tf.feature_column.indicator_column对应一个分类的列。</p>
<p>核心api：<br><b><br>tf.feature_column.categorical_column_with_vocabulary_list<br>tf.feature_column.indicator_column<br></b></p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 这里分类仅使用几个特征列</span><br><span class="line">categories = &#123;</span><br><span class="line">    <span class="string">'sex'</span>: [<span class="string">'male'</span>, <span class="string">'female'</span>],</span><br><span class="line">    <span class="string">'class'</span> : [<span class="string">'First'</span>, <span class="string">'Second'</span>, <span class="string">'Third'</span>],</span><br><span class="line">    <span class="string">'deck'</span> : [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>],</span><br><span class="line">    <span class="string">'embark_town'</span> : [<span class="string">'Cherbourg'</span>, <span class="string">'Southhampton'</span>, <span class="string">'Queenstown'</span>],</span><br><span class="line">    <span class="string">'alone'</span> : [<span class="string">'y'</span>, <span class="string">'n'</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">categorical_columns=[]</span><br><span class="line">for feature,vocab in catecategories.items():</span><br><span class="line">    cat_col=tf.feature_column.categorical_column_with_vocabulary_list(</span><br><span class="line">        key=feature,</span><br><span class="line">        vocabulary_list=vocab)</span><br><span class="line">    categorical_columns.append(tf.feature_column.indicator_column(cat_col))</span><br><span class="line"></span><br><span class="line">print(categorical_columns)</span><br></pre></td></tr></table></figure>
<h4 id="连续型数据处理"><a href="#连续型数据处理" class="headerlink" title="连续型数据处理"></a>连续型数据处理</h4><p>处理完分类数据之后需要处理连续数据.主要需要进行归一化处理.</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def process_continuous_data(mean,data):</span><br><span class="line">    # 标准化数据</span><br><span class="line">    # <span class="keyword">tf</span>.cas<span class="variable">t:</span>转换数据格式</span><br><span class="line">    data=<span class="keyword">tf</span>.cast(data,<span class="keyword">tf</span>.float32)*<span class="number">1</span>/(<span class="number">2</span>*mean)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">tf</span>.reshape(data,[-<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line">	</span><br><span class="line">MEANS = &#123;</span><br><span class="line">    <span class="string">'age'</span> : <span class="number">29.631308</span>,</span><br><span class="line">    <span class="string">'n_siblings_spouses'</span> : <span class="number">0.545455</span>,</span><br><span class="line">    <span class="string">'parch'</span> : <span class="number">0.379585</span>,</span><br><span class="line">    <span class="string">'fare'</span> : <span class="number">34.385399</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">numerical_columns=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> feature in MEANS.<span class="built_in">keys</span>():</span><br><span class="line">    num_col=<span class="keyword">tf</span>.feature_column.numeric_column(</span><br><span class="line">        feature,</span><br><span class="line">        normalizer_fn=functools.partial(process_continuous_data,MEANS[feature]))</span><br><span class="line">    numerical_columns.<span class="keyword">append</span>(num_col)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(numerical_columns)</span><br></pre></td></tr></table></figure>
<p>输出的结果就是各个连续值特征归一化的值:<br><img src="https://s1.ax1x.com/2020/04/26/JRAVmT.png" alt=""></p>
<h4 id="创建预处理层"><a href="#创建预处理层" class="headerlink" title="创建预处理层"></a>创建预处理层</h4><p>上面分别介绍了 离散型特征 和 连续型特征 的处理方法，现在需要对两类型的特征进行合并，从而创建一个能进行预处理的输入层。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preprocessing_layer = tf<span class="selector-class">.keras</span><span class="selector-class">.layers</span><span class="selector-class">.DenseFeatures</span>(categorical_columns+numerical_columns)</span><br></pre></td></tr></table></figure>
<h3 id="模型构建，训练与评估"><a href="#模型构建，训练与评估" class="headerlink" title="模型构建，训练与评估"></a>模型构建，训练与评估</h3><p>这里暂时先插一句，在tf2.0的版本中，调用构建神经网络中各种层都是使用 tf.keras.layers 来进行构建。<br>同时，由于这是一个Sequential模型，所以要使用 tf.keras.Sequential 方法来创建。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">model=tf.keras.Sequential([</span><br><span class="line">    preprocessing_layer,</span><br><span class="line">    tf.keras.layers.Dense(128,activation=<span class="string">'relu'</span>),<span class="comment"># 基于特征层的基础上构建全连接层</span></span><br><span class="line">    tf.keras.layers.Dense(128,activation=<span class="string">'relu'</span>),</span><br><span class="line">    tf.keras.layers.Dense(1,activation=<span class="string">'sigmoid'</span>)<span class="comment"># 最后只需要预测一个结果</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model.compile(</span><br><span class="line">    loss=<span class="string">'binary_crossentropy'</span>,<span class="comment"># 定义损失函数</span></span><br><span class="line">    optimizer=<span class="string">'adam'</span>,<span class="comment"># 定义优化器</span></span><br><span class="line">    metrics=[<span class="string">'accuracy'</span>])<span class="comment"># 定义衡量结果的标准</span></span><br><span class="line">	</span><br><span class="line">train_data=raw_train_data.shuffle(500) <span class="comment"># 打乱数据</span></span><br><span class="line">test_data=raw_test_data</span><br><span class="line"></span><br><span class="line">model.fit(train_data,epochs=20) <span class="comment"># 训练模型</span></span><br><span class="line"></span><br><span class="line">test_loss, test_accuracy = model.evaluate(test_data) <span class="comment"># 测试模型</span></span><br><span class="line"><span class="built_in">print</span>(test_loss)</span><br><span class="line"><span class="built_in">print</span>(test_accuracy)</span><br></pre></td></tr></table></figure></p>
<h4 id="简易版泰坦尼克生存预测模型完整代码"><a href="#简易版泰坦尼克生存预测模型完整代码" class="headerlink" title="简易版泰坦尼克生存预测模型完整代码"></a>简易版泰坦尼克生存预测模型完整代码</h4><p>上面为了分步描述步骤，写得比较简略，这里贴上一个完整版以供参考。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> tensorflow_datasets <span class="keyword">as</span> tfds</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line">file_path=<span class="string">'./dataset/train.csv'</span></span><br><span class="line">file=pd.read_csv(file_path)</span><br><span class="line">csv_columns=list(file.head())</span><br><span class="line">print(csv_columns)<span class="comment">#列表名称</span></span><br><span class="line">print(file.head())<span class="comment">#列表数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 label</span></span><br><span class="line">label_culomn=<span class="string">'survived'</span></span><br><span class="line">labels=[<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dataset</span><span class="params">(file_path)</span>:</span></span><br><span class="line">    dataset=tf.data.experimental.make_csv_dataset(</span><br><span class="line">        file_path,</span><br><span class="line">        batch_size=<span class="number">12</span>,</span><br><span class="line">        label_name=label_culomn,<span class="comment"># 取出某列的数据作为label</span></span><br><span class="line">        na_value=<span class="string">'?'</span>,<span class="comment"># 识别NA/NaN的附加字符串,设置为?</span></span><br><span class="line">        num_epochs=<span class="number">1</span>,<span class="comment"># 遍历数据集的次数</span></span><br><span class="line">        ignore_errors=<span class="keyword">True</span>)</span><br><span class="line">    <span class="keyword">return</span> dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成的值类型为:</span></span><br><span class="line"><span class="comment"># &lt;class 'tensorflow.python.data.ops.dataset_ops.PrefetchDataset'&gt;</span></span><br><span class="line"><span class="comment"># 如果想查看其中的内容,可以使用iter进行迭代,通过next嵌套iter可以查看第一轮运行的数据</span></span><br><span class="line"><span class="comment"># 第一轮运行数据的大小取决于设置的batch_size</span></span><br><span class="line">raw_train_data=get_dataset(file_path) </span><br><span class="line">raw_test_data=get_dataset(file_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看生成的数据集中的样本和标签</span></span><br><span class="line">example,label=next(iter(raw_train_data))</span><br><span class="line">print(<span class="string">'Example:'</span>,example) <span class="comment"># sex,age,n_siblings_spouses,parch,fare,class,deck,embark_town,alone</span></span><br><span class="line">print(<span class="string">'Label:'</span>,label) <span class="comment"># label:survived</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理离散型特征</span></span><br><span class="line">categories = &#123;</span><br><span class="line">    <span class="string">'sex'</span>: [<span class="string">'male'</span>, <span class="string">'female'</span>],</span><br><span class="line">    <span class="string">'class'</span> : [<span class="string">'First'</span>, <span class="string">'Second'</span>, <span class="string">'Third'</span>],</span><br><span class="line">    <span class="string">'deck'</span> : [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>],</span><br><span class="line">    <span class="string">'embark_town'</span> : [<span class="string">'Cherbourg'</span>, <span class="string">'Southhampton'</span>, <span class="string">'Queenstown'</span>],</span><br><span class="line">    <span class="string">'alone'</span> : [<span class="string">'y'</span>, <span class="string">'n'</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">categorical_columns=[]</span><br><span class="line"><span class="keyword">for</span> feature,vocab <span class="keyword">in</span> catecategories.items():</span><br><span class="line">    cat_col=tf.feature_column.categorical_column_with_vocabulary_list(</span><br><span class="line">        key=feature,</span><br><span class="line">        vocabulary_list=vocab)</span><br><span class="line">    categorical_columns.append(tf.feature_column.indicator_column(cat_col))</span><br><span class="line"></span><br><span class="line">print(categorical_columns)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_continuous_data</span><span class="params">(mean,data)</span>:</span></span><br><span class="line">    <span class="comment"># 标准化数据</span></span><br><span class="line">    <span class="comment"># tf.cast:转换数据格式</span></span><br><span class="line">    data=tf.cast(data,tf.float32)*<span class="number">1</span>/(<span class="number">2</span>*mean)</span><br><span class="line">    <span class="keyword">return</span> tf.reshape(data,[<span class="number">-1</span>,<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">MEANS = &#123;</span><br><span class="line">    <span class="string">'age'</span> : <span class="number">29.631308</span>,</span><br><span class="line">    <span class="string">'n_siblings_spouses'</span> : <span class="number">0.545455</span>,</span><br><span class="line">    <span class="string">'parch'</span> : <span class="number">0.379585</span>,</span><br><span class="line">    <span class="string">'fare'</span> : <span class="number">34.385399</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">numerical_columns=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> feature <span class="keyword">in</span> MEANS.keys():</span><br><span class="line">    num_col=tf.feature_column.numeric_column(</span><br><span class="line">        feature,</span><br><span class="line">        normalizer_fn=functools.partial(process_continuous_data,MEANS[feature]))</span><br><span class="line">    numerical_columns.append(num_col)</span><br><span class="line"></span><br><span class="line">print(numerical_columns)</span><br><span class="line"></span><br><span class="line">preprocessing_layer = tf.keras.layers.DenseFeatures(categorical_columns+numerical_columns)</span><br><span class="line"></span><br><span class="line">model=tf.keras.Sequential([</span><br><span class="line">    preprocessing_layer,</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">128</span>,activation=<span class="string">'relu'</span>),<span class="comment"># 基于特征层的基础上构建全连接层</span></span><br><span class="line">    tf.keras.layers.Dense(<span class="number">128</span>,activation=<span class="string">'relu'</span>),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">1</span>,activation=<span class="string">'sigmoid'</span>)<span class="comment"># 最后只需要预测一个结果</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model.compile(</span><br><span class="line">    loss=<span class="string">'binary_crossentropy'</span>,<span class="comment"># 定义损失函数</span></span><br><span class="line">    optimizer=<span class="string">'adam'</span>,<span class="comment"># 定义优化器</span></span><br><span class="line">    metrics=[<span class="string">'accuracy'</span>])<span class="comment"># 定义衡量结果的标准</span></span><br><span class="line">	</span><br><span class="line">train_data=raw_train_data.shuffle(<span class="number">500</span>) <span class="comment"># 打乱数据</span></span><br><span class="line">test_data=raw_test_data</span><br><span class="line"></span><br><span class="line">model.fit(train_data,epochs=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">test_loss, test_accuracy = model.evaluate(test_data) <span class="comment"># 测试模型</span></span><br><span class="line">print(test_loss)</span><br><span class="line">print(test_accuracy)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/04/26/TensorFlow-2-0-使用指南/" data-id="ck9gpdfnc00198cv468yb6ypt" class="article-share-link">Compartir</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NLP/">NLP</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2020/04/14/【统计自然语言处理】形式语言与自动机/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Viejo</strong>
      <div class="article-nav-title">【统计自然语言处理】形式语言与自动机</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
    <h3 class="widget-title">联系方式</h3>
    <div class="widget">
	  <li><a>klausvon@163.com</a></li>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">目录</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/AI-Learning/">AI_Learning</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP/">NLP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP-知识图谱/">NLP,知识图谱</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/VQA/">VQA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/XSS漏洞学习/">XSS漏洞学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码审计/">代码审计</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发/">开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数学学习/">数学学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞学习/">漏洞学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/环境配置/">环境配置</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/神经网络/">神经网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTF-Web/">CTF_Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NLP/">NLP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL-injection/">SQL_injection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VQA/">VQA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XXE/">XXE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/凸包算法/">凸包算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大数据/">大数据</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开发/">开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数学学习/">数学学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据挖掘/">数据挖掘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/环境配置/">环境配置</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/知识图谱/">知识图谱</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/神经网络/">神经网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法考核/">算法考核</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nube de Tags</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algorithm/" style="font-size: 14.29px;">Algorithm</a> <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/CTF-Web/" style="font-size: 18.57px;">CTF_Web</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/NLP/" style="font-size: 20px;">NLP</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/Python/" style="font-size: 11.43px;">Python</a> <a href="/tags/SQL-injection/" style="font-size: 12.86px;">SQL_injection</a> <a href="/tags/VQA/" style="font-size: 10px;">VQA</a> <a href="/tags/XXE/" style="font-size: 10px;">XXE</a> <a href="/tags/凸包算法/" style="font-size: 10px;">凸包算法</a> <a href="/tags/大数据/" style="font-size: 11.43px;">大数据</a> <a href="/tags/开发/" style="font-size: 12.86px;">开发</a> <a href="/tags/数学学习/" style="font-size: 11.43px;">数学学习</a> <a href="/tags/数据挖掘/" style="font-size: 11.43px;">数据挖掘</a> <a href="/tags/环境配置/" style="font-size: 10px;">环境配置</a> <a href="/tags/知识图谱/" style="font-size: 17.14px;">知识图谱</a> <a href="/tags/神经网络/" style="font-size: 15.71px;">神经网络</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/算法考核/" style="font-size: 10px;">算法考核</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archivos</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Posts recientes</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/04/26/TensorFlow-2-0-使用指南/">TensorFlow 2.0 使用指南 (2020.4.26更新)</a>
          </li>
        
          <li>
            <a href="/2020/04/14/【统计自然语言处理】形式语言与自动机/">【统计自然语言处理】形式语言与自动机</a>
          </li>
        
          <li>
            <a href="/2020/04/09/【论文笔记】Preemptive-Information-Extraction-using-Unrestricted-Relation-Discovery/">【论文笔记】Preemptive Information Extraction using Unrestricted Relation Discovery</a>
          </li>
        
          <li>
            <a href="/2020/04/07/【论文笔记】Semantic-Compositionality-through-Recursive-Matrix-Vector-Spaces/">【论文笔记】Semantic Compositionality through Recursive Matrix-Vector Spaces</a>
          </li>
        
          <li>
            <a href="/2020/04/06/【论文笔记】Discovering-Relations-among-Named-Entities-from-Large-Corpora/">【论文笔记】Discovering Relations among Named Entities from Large Corpora</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
	  <li><a href="http://030.im/" title="Misaka030">Misaka030</a></li>
      <li><a href="http://cicisite.me/" title="cici's blog">cici</a></li>
	  <li><a href="http://guoxiaobo.com/" title="Guo Sir">Guo Sir</a></li>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Klaus<br>
      Construido por <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>